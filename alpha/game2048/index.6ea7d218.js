const e=125,t=4*(e+20)+20,r=4*(e+20)+20,l=["2","4","8","16","32","64","128","256","512","1024","2048"],o=["#EEE4DA","#EDE0C8","#EDA166","#F08151","#F1654D","#F1462E","#E8C65F","#E8C34F","#E8BE40","#E8BB31","#E8B724"],n=[70,70,70,60,60,60,50,50,50,50,40];let a=document.createElement("canvas"),i=a.getContext("2d");a.width=t,a.height=r,a.style.cssText="position: absolute; inset: 0; margin: auto;",document.body.appendChild(a),document.body.style.backgroundColor="#F9F7EB";let f=Array.from({length:4},()=>[,,,,].fill(-1)),s=0;document.addEventListener("keydown",e=>{let t=d[e.key];if(!t)return;let r=t(JSON.parse(JSON.stringify(f)));r.toString()!==f.toString()&&(f=r,m())});const h=e=>{let t=[],r=!1;for(let l=e.length-1;l>=0;l--)-1!==e[l]&&(r&&e[l]===t[0]?(s=Math.max(++t[0],s),r=!1):(t.unshift(e[l]),r=!0));return Array(e.length-t.length).fill(-1).concat(t)},c=e=>e[0].map((t,r)=>e.map(e=>e[r])),d={ArrowUp:e=>e.map(e=>h(e.reverse()).reverse()),ArrowDown:e=>e.map(e=>h(e)),ArrowLeft:e=>c(c(e).map(e=>h(e.reverse()).reverse())),ArrowRight:e=>c(c(e).map(e=>h(e)))},m=()=>{if(i.clearRect(0,0,t,r),A(),u(),E())return alert("你赢了");let{x:e,y:l}=x();if(f[e][l]=.5>Math.random()?0:1,y(e,l,f[e][l]),g())return alert("你输了！")},E=()=>s===l.length-1,g=()=>!f.some((e,t)=>e.some((r,l)=>-1===r||r===e[l+1]||r===f[t+1]?.[l])),y=(t,r,a,f=e)=>{let[s,h,c]=[l,o,n].map(e=>e[a]);F(t,r,h),i.font=`${c}px serif`,i.fillStyle=a<2?"#645B52":"#F7F4EF",i.textBaseline="middle",i.textAlign="center",i.fillText(s,p(t)+f/2,p(r)+f/2)},p=t=>t*(20+e)+20,u=()=>f.forEach((e,t)=>e.forEach((e,r)=>-1!==e&&y(t,r,e))),A=()=>{i.fillStyle="#AD9D8F",i.fillRect(0,0,t,r);for(let e=0;e<4;e++)for(let t=0;t<4;t++)F(e,t)},F=(t,r,l="#C2B4A5")=>{i.fillStyle=l,i.fillRect(p(t),p(r),e,e)},x=()=>{let e=[];return f.forEach((t,r)=>t.forEach((t,l)=>-1===t&&e.push({x:r,y:l}))),e[Math.floor(Math.random()*e.length)]};window.onload=()=>{for(let e=0;e<2;e++){let{x:e,y:t}=x();f[e][t]=.5>Math.random()?0:1}A(),u()};