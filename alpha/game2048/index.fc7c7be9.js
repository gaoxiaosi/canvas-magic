const e=125,t=4*e+100,r=4*e+100,l=["2","4","8","16","32","64","128","256","512","1024","2048"],o=["#EEE4DA","#EDE0C8","#EDA166","#F08151","#F1654D","#F1462E","#E8C65F","#E8C34F","#E8BE40","#E8BB31","#E8B724"],n=[70,70,70,60,60,60,50,50,50,50,40];/** @type {HTMLCanvasElement} */let a=document.createElement("canvas"),i=a.getContext("2d");a.width=t,a.height=r,a.style.cssText="position: absolute; inset: 0; margin: auto;",document.body.appendChild(a),document.body.style.backgroundColor="#F9F7EB";let f=Array.from({length:4},()=>[,,,,].fill(-1));// 当前最大值（判断是否达到2048）
document.addEventListener("keydown",e=>{let t=h[e.key];t&&s(t,f)});const s=(e,t)=>{let r=e(JSON.parse(JSON.stringify(t)));r.toString()!==t.toString()&&(f=r,E())},c=e=>{let t=[],r=!1;for(let l=e.length-1;l>=0;l--)-1!==e[l]&&(r&&e[l]===t[0]?(t[0]++,r=!1):(t.unshift(e[l]),r=!0));return Array(e.length-t.length).fill(-1).concat(t)},d=e=>e[0].map((t,r)=>e.map(e=>e[r])),h={ArrowUp:e=>e.map(e=>c(e.reverse()).reverse()),ArrowDown:e=>e.map(e=>c(e)),ArrowLeft:e=>d(d(e).map(e=>c(e.reverse()).reverse())),ArrowRight:e=>d(d(e).map(e=>c(e)))},E=()=>{if(m())return alert("你赢了");let{x:e,y:l}=w(f);if(f[e][l]=.5>Math.random()?0:1,i.clearRect(0,0,t,r),A(),u(f),g())return alert("你输了！")},m=()=>0==l.length-1,g=()=>!f.some((e,t)=>e.some((r,l)=>-1===r||r===e[l+1]||r===f[t+1]?.[l])),y=(t,r,a,f=e)=>{let[s,c,d]=[l,o,n].map(e=>e[a]);F(t,r,c),i.font=`${d}px serif`,i.fillStyle=a<2?"#645B52":"#F7F4EF",i.textBaseline="middle",i.textAlign="center",i.fillText(s,p(t)+f/2,p(r)+f/2)},p=t=>t*(20+e)+20,u=e=>e.forEach((t,r)=>t.forEach((t,l)=>{F(r,l),-1!==e[r][l]&&y(r,l,e[r][l])})),A=()=>{i.fillStyle="#AD9D8F",i.fillRect(0,0,t,r)},F=(t,r,l="#C2B4A5")=>{i.fillStyle=l,i.fillRect(p(t),p(r),e,e)},w=e=>{let t=[];return e.forEach((r,l)=>r.forEach((r,o)=>-1===e[l][o]&&t.push({x:l,y:o}))),t[Math.floor(Math.random()*t.length)]};window.onload=()=>{for(let e=0;e<2;e++){let{x:e,y:t}=w(f);f[e][t]=.5>Math.random()?0:1}A(),u(f)};