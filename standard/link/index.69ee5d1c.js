const e=100,t=e/12,l=e/2,o=6*(e+10)+10+2*l,y=6*(e+10)+10+2*l,i=["A","B","C","D","E","F","G"],r=["#409EFF","#67C23A","#E6A23C","#F56C6C","#B37FEB","#FF85C0","#36CFC9"],n="#00AEEC",x="#F8BBD0";let s=document.createElement("canvas"),f=s.getContext("2d");s.style.cssText="position: absolute; inset: 0; margin: auto; cursor: pointer;",s.width=o,s.height=y,document.body.appendChild(s),document.body.style.backgroundColor=x;let c=Array.from({length:8},()=>Array(8).fill(-1)),a={x:-1,y:-1},h={x:-1,y:-1},d={x:-1,y:-1},g={x:-1,y:-1},F=0;s.onclick=async t=>{let[o,y]=[t.offsetX,t.offsetY].map(t=>Math.ceil((t-l)/(e+10)));if(t.offsetX-(o-1)*(e+10)-l<10||t.offsetY-(y-1)*(e+10)-l<10||-1===c[o][y])return;E(o,y);let i=a.x,r=a.y;if(-1===i&&-1===r)a={x:o,y:y};else{if(i===o&&r===y){a={x:-1,y:-1},A(o,y);return}g={x:o,y:y},S(a,g)?(k(),c[i][r]=-1,c[o][y]=-1,a={x:-1,y:-1},g={x:-1,y:-1},F++,await m(256),w(),u()&&alert("游戏结束，你赢了")):(A(i,r),a={x:o,y:y},g={x:-1,y:-1})}};const m=e=>new Promise(t=>setTimeout(t,e)),u=()=>2*F==36,p=(e,t)=>{let{x:l,y:o}=e,{x:y,y:i}=t;return l===y?(o>i&&([o,i]=[i,o]),c[l].slice(o+1,i).every(e=>-1===e)):o===i&&(l>y&&([l,y]=[y,l]),c.slice(l+1,y).every(e=>-1===e[o]))},C=(e,t)=>{let{x:l,y:o}=e,{x:y,y:i}=t;for(let[e,r]of[[1,0],[-1,0],[0,1],[0,-1]]){let n=0,x=l,s=o;for(;c[x=l+e*++n]?.[s=o+r*n]===-1;)if(h={x:x,y:s},d=0===e?{x:y,y:s}:{x:x,y:i},JSON.stringify(d)===JSON.stringify(t)&&p(h,t)||-1===c[d.x][d.y]&&p(h,d)&&p(d,t))return!0}return!1},S=(e,t)=>(h=e,d=t,c[e.x][e.y]===c[t.x][t.y]&&(!!p(e,t)||C(e,t))),E=(l,o,y=n)=>{f.strokeStyle=y,f.lineWidth=t,f.strokeRect(J(l)+t/2,J(o)+t/2,e-t,e-t)},A=(e,t)=>{b(e,t,c[e][t])},k=(l=[a,h,d,g],o=t,y=n)=>{console.log(l),JSON.stringify(d)===JSON.stringify(g)&&l.splice(2,1),JSON.stringify(a)===JSON.stringify(h)&&l.splice(1,1);let i=(l=l.map(e=>({...e,ox:.5,oy:.5}))).length;l[0].x===l[1].x?l[0].oy=+(l[0].y<l[1].y):l[0].ox=+(l[0].x<l[1].x),l[i-1].x===l[i-2].x?l[i-1].oy=+(l[i-1].y<l[i-2].y):l[i-1].ox=+(l[i-1].x<l[i-2].x),l=l.map(({x:t,y:l,ox:o,oy:y})=>({x:J(t)+e*o,y:J(l)+e*y})),f.lineWidth=o,f.strokeStyle=y,f.beginPath();let{x:r,y:x}=l.shift();f.moveTo(r,x),l.forEach(({x:e,y:t})=>f.lineTo(e,t)),f.stroke()},B=()=>{f.fillStyle=x,f.fillRect(l,l,o-2*l,y-2*l)},J=t=>(t-1)*(e+10)+10+l,N=e=>e.sort(()=>Math.random()-.5),O=()=>{let e=[],t=0;for(let l=0;l<18;l++)t=l%i.length,e.push(t,t);let l=N(e);for(let e=1;e<7;e++)for(let t=1;t<7;t++)c[e][t]=l.pop()},b=(t,l,o,y=e)=>{t=J(t),l=J(l),f.fillStyle=r[o%r.length],f.fillRect(t,l,y,y),f.font="40px serif",f.fillStyle="#FFFFFF",f.textBaseline="middle",f.textAlign="center",f.fillText(i[o],t+y/2,l+y/2)},w=()=>{f.clearRect(0,0,o,y),B(),c.forEach((e,t)=>e.forEach((e,l)=>-1!==e&&b(t,l,e)))},T=async()=>{O(),w()};window.onload=T;