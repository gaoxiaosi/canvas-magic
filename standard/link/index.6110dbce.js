const e=100,t=e/12,l=e/2,o=6*(e+10)+10+2*l,y=6*(e+10)+10+2*l,r=["A","B","C","D","E","F","G"],x=["#409EFF","#67C23A","#E6A23C","#F56C6C","#B37FEB","#FF85C0","#36CFC9"],n="#00AEEC",i="#F8BBD0";let f=document.createElement("canvas"),s=f.getContext("2d");f.style.cssText="position: absolute; inset: 0; margin: auto; cursor: pointer;",f.width=o,f.height=y,document.body.appendChild(f),document.body.style.backgroundColor=i;let a=Array.from({length:8},()=>Array(8).fill(-1)),c={x:-1,y:-1},h=0;f.onclick=async t=>{let[o,y]=[t.offsetX,t.offsetY].map(t=>Math.ceil((t-l)/(e+10)));if(t.offsetX-(o-1)*(e+10)-l<10||t.offsetY-(y-1)*(e+10)-l<10||-1===a[o][y])return;g(o,y);let r=c.x,x=c.y;if(-1===r&&-1===x)c={x:o,y:y};else{if(r===o&&x===y){c={x:-1,y:-1},p(o,y);return}C(c,{x:o,y:y})?(E(),a[r][x]=-1,a[o][y]=-1,c={x:-1,y:-1},h++,await d(256),S(),F()&&alert("游戏结束，你赢了")):(p(r,x),c={x:o,y:y})}};const d=e=>new Promise(t=>setTimeout(t,e)),F=()=>2*h==36,m=(e,t)=>{let{x:l,y:o}=e,{x:y,y:r}=t;return l===y?(o>r&&([o,r]=[r,o]),a[l].slice(o+1,r).every(e=>-1===e)):o===r&&(l>y&&([l,y]=[y,l]),a.slice(l+1,y).every(e=>-1===e[o]))},u=(e,t)=>{let{x:l,y:o}=e,{x:y,y:r}=t;for(let[e,x]of[[1,0],[-1,0],[0,1],[0,-1]]){let n=0,i=l,f=o,s={},c={};for(;a[i=l+e*++n]?.[f=o+x*n]===-1;)if(s={x:i,y:f},(c=0===e?{x:y,y:f}:{x:i,y:r}).x===y&&c.y===r&&m(s,t)||-1===a[c.x][c.y]&&m(s,c)&&m(c,t))return!0}return!1},C=(e,t)=>a[e.x][e.y]===a[t.x][t.y]&&(!!m(e,t)||u(e,t)),g=(l,o,y=n)=>{s.strokeStyle=y,s.lineWidth=t,s.strokeRect(k(l)+t/2,k(o)+t/2,e-t,e-t)},p=(e,t)=>{w(e,t,a[e][t])},E=(l,o=t,y=n)=>{console.log(l);let r=(l=l.map(e=>({...e,ox:.5,oy:.5}))).length;l[0].x===l[1].x?l[0].oy=+(l[0].y<l[1].y):l[0].ox=+(l[0].x<l[1].x),l[r-1].x===l[r-2].x?l[r-1].oy=+(l[r-1].y<l[r-2].y):l[r-1].ox=+(l[r-1].x<l[r-2].x),l=l.map(({x:t,y:l,ox:o,oy:y})=>({x:k(t)+e*o,y:k(l)+e*y})),s.lineWidth=o,s.strokeStyle=y,s.beginPath();let{x:x,y:i}=l.shift();s.moveTo(x,i),l.forEach(({x:e,y:t})=>s.lineTo(e,t)),s.stroke()},A=()=>{s.fillStyle=i,s.fillRect(l,l,o-2*l,y-2*l)},k=t=>(t-1)*(e+10)+10+l,B=e=>e.sort(()=>Math.random()-.5),b=()=>{let e=[],t=0;for(let l=0;l<18;l++)t=l%r.length,e.push(t,t);let l=B(e);for(let e=1;e<7;e++)for(let t=1;t<7;t++)a[e][t]=l.pop()},w=(t,l,o,y=e)=>{t=k(t),l=k(l),s.fillStyle=x[o%x.length],s.fillRect(t,l,y,y),s.font="40px serif",s.fillStyle="#FFFFFF",s.textBaseline="middle",s.textAlign="center",s.fillText(r[o],t+y/2,l+y/2)},S=()=>{s.clearRect(0,0,o,y),A(),a.forEach((e,t)=>e.forEach((e,l)=>-1!==e&&w(t,l,e)))},T=async()=>{b(),S()};window.onload=T;