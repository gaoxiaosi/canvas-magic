const e=100,t=e/12,o=e/2+t,l=6*(e+10)+10+2*o,r=6*(e+10)+10+2*o,y=["A","B","C","D","E","F","G"],n=["#409EFF","#67C23A","#E6A23C","#F56C6C","#B37FEB","#FF85C0","#36CFC9"],x="#00AEEC";let i=document.createElement("canvas"),s=i.getContext("2d");i.style.cssText="position: absolute; inset: 0; margin: auto; cursor: pointer;",i.width=l,i.height=r,document.body.appendChild(i),document.body.style.backgroundColor="#F8BBD0";let f=Array.from({length:8},()=>Array(8).fill(-1)),a={x:-1,y:-1},c=0;i.onclick=async t=>{let[l,r]=[t.offsetX,t.offsetY].map(t=>Math.ceil((t-o)/(e+10)));if(t.offsetX-(l-1)*(e+10)-o<10||t.offsetY-(r-1)*(e+10)-o<10||-1===f[l][r])return;C(l,r);let y=a.x,n=a.y;if(-1===y&&-1===n)a={x:l,y:r};else{if(y===l&&n===r){a={x:-1,y:-1},g(l,r);return}let e=[];(e=m(a,{x:l,y:r}))?(p(e),f[y][n]=-1,f[l][r]=-1,a={x:-1,y:-1},c++,await d(256),b(),h()&&alert("游戏结束，你赢了")):(g(y,n),a={x:l,y:r})}};const d=e=>new Promise(t=>setTimeout(t,e)),h=()=>2*c==36,u=(e,t)=>{let{x:o,y:l}=e,{x:r,y:y}=t;return o===r?(l>y&&([l,y]=[y,l]),f[o].slice(l+1,y).every(e=>-1===e)):l===y&&(o>r&&([o,r]=[r,o]),f.slice(o+1,r).every(e=>-1===e[l]))},F=(e,t)=>{let{x:o,y:l}=e,{x:r,y:y}=t;for(let[n,x]of[[1,0],[-1,0],[0,1],[0,-1]]){let i=0,s=o,a=l,c={},d={};for(;f[s=o+n*++i]?.[a=l+x*i]===-1;){if(c={x:s,y:a},(d=0===n?{x:r,y:a}:{x:s,y:y}).x===r&&d.y===y&&u(c,t))return[e,c,t];if(-1===f[d.x][d.y]&&u(c,d)&&u(d,t))return[e,c,d,t]}}return!1},m=(e,t)=>f[e.x][e.y]===f[t.x][t.y]&&(u(e,t)?[e,t]:F(e,t)),C=(o,l,r=x)=>{s.strokeStyle=r,s.lineWidth=t,s.strokeRect(E(o)+t/2,E(l)+t/2,e-t,e-t)},g=(e,t)=>{B(e,t,f[e][t])},p=(o,l=t,r=x)=>{console.log(o);let y=(o=o.map(e=>({...e,ox:.5,oy:.5}))).length;o[0].x===o[1].x?o[0].oy=+(o[0].y<o[1].y):o[0].ox=+(o[0].x<o[1].x),o[y-1].x===o[y-2].x?o[y-1].oy=+(o[y-1].y<o[y-2].y):o[y-1].ox=+(o[y-1].x<o[y-2].x),o=o.map(({x:t,y:o,ox:l,oy:r})=>({x:E(t)+e*l,y:E(o)+e*r})),s.lineWidth=l,s.strokeStyle=r,s.beginPath();let{x:n,y:i}=o.shift();s.moveTo(n,i),o.forEach(({x:e,y:t})=>s.lineTo(e,t)),s.stroke()},E=t=>(t-1)*(e+10)+10+o,A=e=>e.sort(()=>Math.random()-.5),k=()=>{let e=[],t=0;for(let o=0;o<18;o++)t=o%y.length,e.push(t,t);e=A(e);for(let t=1;t<7;t++)for(let o=1;o<7;o++)f[t][o]=e.pop()},B=(t,o,l,r=e)=>{t=E(t),o=E(o),s.fillStyle=n[l%n.length],s.fillRect(t,o,r,r),s.font="40px serif",s.fillStyle="#FFFFFF",s.textBaseline="middle",s.textAlign="center",s.fillText(y[l],t+r/2,o+r/2)},b=()=>{s.clearRect(0,0,l,r);for(let e=1;e<7;e++)for(let t=1;t<7;t++)-1!==f[e][t]&&B(e,t,f[e][t])},w=async()=>{k(),b()};window.onload=w;