var t=globalThis,e={},a={},n=t.parcelRequire6f20;null==n&&((n=function(t){if(t in e)return e[t].exports;if(t in a){var n=a[t];delete a[t];var l={id:t,exports:{}};return e[t]=l,n.call(l.exports,l,l.exports),l.exports}var r=Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(t,e){a[t]=e},t.parcelRequire6f20=n),(0,n.register)("8PRdk",function(t,e){Object.defineProperty(t.exports,"default",{get:()=>a,set:void 0,enumerable:!0,configurable:!0});var a=/**
 * @class
 * @description 在当前canvas之上覆盖一个大小位置都一样的canvas遮罩层
 */class{/**
   * @decription 在当前canvas之上覆盖一个大小位置都一样的canvas遮罩层
   * @constructor
   * @param {Object} options 模态窗的配置参数
   * @param {HTMLCanvasElement} options.canvas 原先的canvas对象
   * @param {Function} options.onSuccess 点击“成功“按钮，执行回调
   * @param {Function} options.onCancel 点击”取消“按钮，执行回调
   * @param {string} options.primaryColor 主题颜色，用于设置标题字体颜色，按钮颜色
   * @param {string} options.maskColor 遮罩层颜色，建议带透明度，如rgba(128, 128, 128, 0.6)
   * @param {string} options.btnTextColor 按钮字体颜色，默认白色
   * @param {string} options.textTitle 标题文本
   * @param {string} options.successBtnText 成功按钮的文本
   * @param {string} options.cancelBtnText 取消按钮的文本
   */constructor({canvas:t,onSuccess:e,onCancel:a,primaryColor:n="#F56C6C",maskColor:l="rgba(128, 128, 128, 0.6)",btnTextColor:r="#FFFFFF",textTitle:i="游戏结束",successBtnText:o="重新开始",cancelBtnText:s="取消"}){Object.assign(this,{onSuccess:e,onCancel:a,primaryColor:n,maskColor:l,btnTextColor:r,textTitle:i,successBtnText:o,cancelBtnText:s,W:t.width,H:t.height,titleH:50,titleBtnSpacing:50,btnH:40,btnPadding:10,btnSpacing:40// 按钮间距
}),// 和原canvas大小位置都一样的新canvas
// const { top, left } = canvas.getBoundingClientRect();
this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.id=`mask-canvas-${new Date().getTime()}`,this.canvas.width=this.W,this.canvas.height=this.H,// this.canvas.style.cssText = `position: absolute; top: ${top}px; left: ${left}px; cursor: pointer;`;
this.canvas.style.cssText="position: absolute; inset: 0; margin: auto; cursor: pointer;",// 遮罩层Canvas和原Canvas为同级关系，所以添加到原Canvas后面，而不是document.body.appendChild(this.canvas)
t.parentNode.appendChild(this.canvas),this.drawMask(),this.drawTitle(),this.drawButtons()}// 绘制遮罩层
drawMask(){let{ctx:t,H:e,W:a,maskColor:n}=this;t.fillStyle=n,t.fillRect(0,0,a,e)}// 绘制标题
drawTitle(){let{ctx:t,H:e,W:a,btnH:n,textTitle:l,titleH:r,titleBtnSpacing:i,primaryColor:o}=this;t.font=`${r}px Arial`,t.textAlign="center",t.textBaseline="top",t.fillStyle=o,t.fillText(l,a/2,(e-r-i-n)/2)}// 绘制按钮（并绑定点击事件）
drawButtons(){let{canvas:t,ctx:e,H:a,W:n,btnTextColor:l,primaryColor:r,onSuccess:i,onCancel:o,titleH:s,titleBtnSpacing:c,successBtnText:h,cancelBtnText:d,btnH:u,btnPadding:x,btnSpacing:f}=this;// 设置按钮样式（需提前设置字体大小，这样通过measureText方法计算文本内容的宽度）
e.font=`${u-2*x}px Arial`,e.textBaseline="top",e.textAlign="left";let m=e.measureText(h).width+2*x,p=e.measureText(d).width+2*x,v=(a+s+c)/2-u/2,g=(n-m-p-f)/2,y=g+m+f,E=[g,g+m,v,v+u],w=[y,y+p,v,v+u];// 取消按钮所占矩形范围（左右X的范围，上下Y的范围）
// 绘制成功和取消按钮
e.fillStyle=r,e.fillRect(g,v,m,u),e.fillRect(y,v,p,u),e.fillStyle=l,e.fillText(h,g+x,v+x),e.fillText(d,y+x,v+x);// 判断坐标是否在矩形（按钮）范围之内
let F=(t,e,[a,n,l,r])=>t>=a&&t<=n&&e>=l&&e<=r;// 监听点击事件，若点击到成功按钮，执行成功回调；若点击到取消按钮，执行取消回调。（只要点击到按钮都会关闭模态窗）
t.onclick=t=>[i,o][[E,w].findIndex(e=>F(t.offsetX,t.offsetY,e)&&(this.close(),!0))]?.()}// 关闭模态窗（移除DOM节点）
close(){this.ctx.clearRect(0,0,this.W,this.H),this.canvas.onclick=null,document.getElementById(this.canvas.id).remove()}}});var l=n("8PRdk");const r=125,i=4*r+100,o=4*r+100,s="#C2B4A5",c=6,h=["2","4","8","16","32","64","128","256","512","1024","2048"],// VALUES = ['赵', '钱', '孙', '李', '周', '吴', '郑', '王', '冯', '陈', '褚'],
d=["#EEE4DA","#EDE0C8","#EDA166","#F08151","#F1654D","#F1462E","#E8C65F","#E8C34F","#E8BE40","#E8BB31","#E8B724"],u=[70,70,70,60,60,60,50,50,50,50,40],x=64;// 新出现时的初始比例
/** @type {HTMLCanvasElement} */let f=document.createElement("canvas"),m=f.getContext("2d");f.width=i,f.height=o,f.style.cssText="position: absolute; inset: 0; margin: auto;",document.body.appendChild(f),document.body.style.backgroundColor="#F9F7EB";let p=Array.from({length:4},()=>[,,,,].fill(-1)),v=0,g=!1,y=[],E=[],w=[],F=[];document.addEventListener("keydown",t=>{if(g)return;let e=D[t.key];e&&T(e,p,t.key)});const T=async(t,e,a)=>{E=[],y=[],F=[],w=[];let n=t(JSON.parse(JSON.stringify(e)),a);if(n.toString()===e.toString())return;p=n;let l=await C(E,y,a);if(cancelAnimationFrame(l),F.length>0){let t=A[a];F=F.map(({index:e,end:a,val:n})=>t(e,a,n)),w=w.map(({index:e,end:a,val:n})=>t(e,a,n));let e=await b(F,w,B,.3,128);cancelAnimationFrame(e)}R()},A={ArrowUp:(t,e,a,n=0)=>({x:t,y:3-e-n,val:a}),ArrowDown:(t,e,a,n=0)=>({x:t,y:e+n,val:a}),ArrowLeft:(t,e,a,n=0)=>({x:3-e-n,y:t,val:a}),ArrowRight:(t,e,a,n=0)=>({x:e+n,y:t,val:a})},C=(t,e,a,n=x)=>new Promise(l=>{let r=null,s=null,c=[],h=null,d=A[a];e=e.map(({index:t,end:e,val:a})=>d(t,e,a));let u=a=>{r||(r=a),m.clearRect(0,0,i,o),U(),$(p),e.forEach(({x:t,y:e,val:a})=>I(t,e,a)),c.forEach(({x:t,y:e,val:a})=>I(t,e,a)),(s=a-r)<n?(// activeGroup = moveGroup.map(({index, start, val, distance}) => getPos(index, start, val, distance * elapsed / duration));
    c=t.map(({index:t,start:e,val:a,distance:l})=>d(t,e,a,l*Math.sin(s/n*Math.PI/2))),requestAnimationFrame(u)):l(h)};h=requestAnimationFrame(u)}),b=(t,e,a,n,l)=>new Promise(s=>{let c=null,h=null,d=null,u=0,x=f=>{c||(c=f),m.clearRect(0,0,i,o),U(),$(p),e.forEach(({x:t,y:e,val:a})=>I(t,e,a)),t.forEach(({x:t,y:e,val:a})=>I(t-u/2,e-u/2,a,r+r*u,u)),(h=f-c)<l?(// scaleRatio = (1 - Math.abs(1 - elapsed / duration * 2)) * maxScaleRatio
    u=a(h/l,n),requestAnimationFrame(x)):s(d)};d=requestAnimationFrame(x)}),B=(t,e)=>Math.sin(t*Math.PI)*e,S=(t,e)=>-Math.cos(t*Math.PI/2)*e,k=(t,e)=>{let a=[],n=!1,l=t.length;for(let r=l-1;r>=0;r--)-1!==t[r]&&(n&&t[r]===a[0]?(v=Math.max(++a[0],v),n=!1,F.push({index:e,val:t[r],end:l-a.length}),w.pop()):(a.unshift(t[r]),w.push({index:e,val:t[r],end:l-a.length}),n=!0),0==l-a.length-r?y.push({index:e,val:t[r],end:r}):E.push({index:e,val:t[r],start:r,distance:l-a.length-r}));return Array(l-a.length).fill(-1).concat(a)},M=t=>t[0].map((e,a)=>t.map(t=>t[a])),D={ArrowUp:t=>t.map((t,e)=>k(t.reverse(),e).reverse()),ArrowDown:t=>t.map((t,e)=>k(t,e)),ArrowLeft:t=>M(M(t).map((t,e)=>k(t.reverse(),e).reverse())),ArrowRight:t=>M(M(t).map((t,e)=>k(t,e)))},R=async()=>{if(H())g=!0,q("你赢了!");else{let t=[];p.forEach((e,a)=>e.forEach((e,n)=>-1!==e&&t.push({x:a,y:n,val:e})));let{x:e,y:a}=_(p),n=.5>Math.random()?0:1;p[e][a]=n,P()&&(g=!0,q(`\u{4F60}\u{8F93}\u{4E86}\u{FF01}\u{6700}\u{9AD8}\u{5206}\u{FF1A}${h[v]}`)),await b([{x:e,y:a,val:n}],t,S,.3,128)}m.clearRect(0,0,i,o),U(),L(p)},H=()=>v===h.length-1,P=()=>!p.some((t,e)=>t.some((a,n)=>-1===a||a===t[n+1]||a===p[e+1]?.[n])),O=async()=>{let t=[];for(let e=0;e<2;e++){let{x:e,y:a}=_(p),n=.5>Math.random()?0:1;p[e][a]=n,t.push({x:e,y:a,val:n})}await b(t,[],S,.3,128),U(),L(p)},q=t=>new l.default({canvas:f,onSuccess:W,maskColor:"rgba(143, 122, 102, 0.5)",primaryColor:"#EDA166",textTitle:t}),W=()=>{g=!1,p=Array.from({length:4},()=>[,,,,].fill(-1)),v=0,E=[],y=[],F=[],w=[],O()},I=(t,e,a,n=r,l=0)=>{let[i,o,s]=[h,d,u].map(t=>t[a]);j(t,e,o,n),m.font=`${s*(1+l)}px serif`,m.fillStyle=a<2?"#645B52":"#F7F4EF",m.textBaseline="middle",m.textAlign="center",m.fillText(i,N(t)+n/2,N(e)+n/2)},N=t=>t*(20+r)+20,$=t=>t.forEach((t,e)=>t.forEach((t,a)=>j(e,a))),L=t=>t.forEach((t,e)=>t.forEach((t,a)=>{j(e,a),-1!==t&&I(e,a,t)})),U=()=>J(0,0,i,o,6,"#AD9D8F"),j=(t,e,a=s,n=r)=>J(N(t),N(e),n,n,6,a),J=(t,e,a,n,l=c,r)=>{m.beginPath(),m.moveTo(t+l,e),m.arcTo(t+a,e,t+a,e+n,l),m.arcTo(t+a,e+n,t,e+n,l),m.arcTo(t,e+n,t,e,l),m.arcTo(t,e,t+a,e,l),m.closePath(),r&&(m.fillStyle=r,m.fill())},_=t=>{let e=[];return t.forEach((a,n)=>a.forEach((a,l)=>-1===t[n][l]&&e.push({x:n,y:l}))),e[Math.floor(Math.random()*e.length)]};window.onload=O;