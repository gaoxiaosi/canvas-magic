var t=globalThis,e={},a={},n=t.parcelRequire6f20;null==n&&((n=function(t){if(t in e)return e[t].exports;if(t in a){var n=a[t];delete a[t];var l={id:t,exports:{}};return e[t]=l,n.call(l.exports,l,l.exports),l.exports}var i=Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(t,e){a[t]=e},t.parcelRequire6f20=n),(0,n.register)("8PRdk",function(t,e){Object.defineProperty(t.exports,"default",{get:()=>a,set:void 0,enumerable:!0,configurable:!0});var a=class{constructor({isFullScreen:t,canvas:e,onSuccess:a,onCancel:n,primaryColor:l="#F56C6C",maskColor:i="rgba(128, 128, 128, 0.6)",btnTextColor:r="#FFFFFF",textTitle:o="游戏结束",successBtnText:s="重新开始",cancelBtnText:c="取消",titleH:h=50,titleBtnSpacing:d=50,btnH:u=40,btnPadding:p=10,btnSpacing:x=40}){Object.assign(this,{isFullScreen:!1,onSuccess:a,onCancel:n,primaryColor:l,maskColor:i,btnTextColor:r,textTitle:o,successBtnText:s,cancelBtnText:c,W:e?.width,H:e?.height,titleH:h,titleBtnSpacing:d,btnH:u,btnPadding:p,btnSpacing:x}),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.id=`mask-canvas-${new Date().getTime()}`,t?(this.canvas.width=window.innerWidth,this.W=window.innerWidth,this.canvas.height=window.innerHeight,this.H=window.innerHeight,this.canvas.style.cssText="position: absolute; inset: 0; margin: auto; cursor: pointer;",document.body.appendChild(this.canvas)):(this.canvas.width=this.W,this.canvas.height=this.H,this.canvas.style.cssText="position: absolute; inset: 0; margin: auto; cursor: pointer;",e.parentNode.appendChild(this.canvas)),this.drawMask(),this.drawTitle(),this.drawButtons()}drawMask(){let{ctx:t,H:e,W:a,maskColor:n}=this;t.fillStyle=n,t.fillRect(0,0,a,e)}drawTitle(){let{ctx:t,H:e,W:a,btnH:n,textTitle:l,titleH:i,titleBtnSpacing:r,primaryColor:o}=this;t.font=`${i}px Arial`,t.textAlign="center",t.textBaseline="top",t.fillStyle=o,t.fillText(l,a/2,(e-i-r-n)/2)}drawButtons(){let{canvas:t,ctx:e,H:a,W:n,btnTextColor:l,primaryColor:i,onSuccess:r,onCancel:o,titleH:s,titleBtnSpacing:c,successBtnText:h,cancelBtnText:d,btnH:u,btnPadding:p,btnSpacing:x}=this;e.font=`${u-2*p}px Arial`,e.textBaseline="top",e.textAlign="left";let f=e.measureText(h).width+2*p,m=e.measureText(d).width+2*p,g=(a+s+c)/2-u/2,v=(n-f-m-x)/2,y=v+f+x,w=[v,v+f,g,g+u],E=[y,y+m,g,g+u];e.fillStyle=i,e.fillRect(v,g,f,u),e.fillRect(y,g,m,u),e.fillStyle=l,e.fillText(h,v+p,g+p),e.fillText(d,y+p,g+p);let T=(t,e,[a,n,l,i])=>t>=a&&t<=n&&e>=l&&e<=i;t.onclick=t=>[r,o][[w,E].findIndex(e=>T(t.offsetX,t.offsetY,e)&&(this.close(),!0))]?.()}close(){this.ctx.clearRect(0,0,this.W,this.H),this.canvas.onclick=null,document.getElementById(this.canvas.id).remove()}}});var l=n("8PRdk");const i=125,r=4*(i+20)+20,o=4*(i+20)+20,s="#C2B4A5",c=6,h=["2","4","8","16","32","64","128","256","512","1024","2048"],d=["#EEE4DA","#EDE0C8","#EDA166","#F08151","#F1654D","#F1462E","#E8C65F","#E8C34F","#E8BE40","#E8BB31","#E8B724"],u=[70,70,70,60,60,60,50,50,50,50,40],p=64;let x=document.createElement("canvas"),f=x.getContext("2d");x.width=r,x.height=o,x.style.cssText="position: absolute; inset: 0; margin: auto;",document.body.appendChild(x),document.body.style.backgroundColor="#F9F7EB";let m=Array.from({length:4},()=>[,,,,].fill(-1)),g=0,v=!1,y=[],w=[],E=[],T=[];document.addEventListener("keydown",async t=>{if(v)return;let e=t.key,a=M[e];if(!a)return;w=[],y=[],T=[],E=[];let n=a(JSON.parse(JSON.stringify(m)));if(n.toString()!==m.toString()){if(m=n,await b(w,y,e),T.length>0){let t=F[e];T=T.map(({index:e,pos:a,val:n})=>t(e,a,n)),E=E.map(({index:e,pos:a,val:n})=>t(e,a,n)),await C(T,E,A,.3,128)}k()}});const F={ArrowUp:(t,e,a,n=0)=>({x:t,y:3-e-n,val:a}),ArrowDown:(t,e,a,n=0)=>({x:t,y:e+n,val:a}),ArrowLeft:(t,e,a,n=0)=>({x:3-e-n,y:t,val:a}),ArrowRight:(t,e,a,n=0)=>({x:e+n,y:t,val:a})},b=(t,e,a,n=p)=>new Promise(l=>{let i=null,s=null,c=[],h=F[a];e=e.map(({index:t,pos:e,val:a})=>h(t,e,a));let d=a=>{i||(i=a),s=a-i,c=t.map(({index:t,pos:e,val:a,distance:l})=>h(t,e,a,l*Math.sin(s/n*Math.PI/2))),f.clearRect(0,0,r,o),L(),e.forEach(({x:t,y:e,val:a})=>I(t,e,a)),c.forEach(({x:t,y:e,val:a})=>I(t,e,a)),s<n?requestAnimationFrame(d):l()};requestAnimationFrame(d)}),C=(t,e,a,n,l)=>new Promise(s=>{let c=null,h=null,d=0,u=p=>{c||(c=p),console.log(d=a((h=p-c)/l,n)),f.clearRect(0,0,r,o),L(),e.forEach(({x:t,y:e,val:a})=>I(t,e,a)),t.forEach(({x:t,y:e,val:a})=>I(t-d/2,e-d/2,a,i+i*d,d)),h<l?requestAnimationFrame(u):s()};requestAnimationFrame(u)}),A=(t,e)=>Math.sin(t*Math.PI)*e,B=(t,e)=>Math.cos(t*Math.PI/2+Math.PI)*(1-e),S=(t,e)=>{let a=[],n=!1,l=t.length,i=0;for(let r=l-1;r>=0;r--)-1!==t[r]&&(n&&t[r]===a[0]?(g=Math.max(++a[0],g),n=!1,T.push({index:e,val:t[r],pos:l-a.length}),E.pop()):(a.unshift(t[r]),E.push({index:e,val:t[r],pos:l-a.length}),n=!0),0==(i=l-a.length-r)?y.push({index:e,val:t[r],pos:r}):w.push({index:e,val:t[r],pos:r,distance:i}));return Array(l-a.length).fill(-1).concat(a)},H=t=>t[0].map((e,a)=>t.map(t=>t[a])),M={ArrowUp:t=>t.map((t,e)=>S(t.reverse(),e).reverse()),ArrowDown:t=>t.map((t,e)=>S(t,e)),ArrowLeft:t=>H(H(t).map((t,e)=>S(t.reverse(),e).reverse())),ArrowRight:t=>H(H(t).map((t,e)=>S(t,e)))},k=async()=>{if(P())v=!0,W("你赢了!");else{let t=[];m.forEach((e,a)=>e.forEach((e,n)=>-1!==e&&t.push({x:a,y:n,val:e})));let{x:e,y:a}=j(m),n=.5>Math.random()?0:1;m[e][a]=n,D()&&(v=!0,W(`\u{4F60}\u{8F93}\u{4E86}\u{FF01}\u{6700}\u{9AD8}\u{5206}\u{FF1A}${h[g]}`)),await C([{x:e,y:a,val:n}],t,B,.7,256)}f.clearRect(0,0,r,o),L(),N()},P=()=>g===h.length-1,D=()=>!m.some((t,e)=>t.some((a,n)=>-1===a||a===t[n+1]||a===m[e+1]?.[n])),R=async()=>{let t=[];for(let e=0;e<2;e++){let{x:e,y:a}=j(m),n=.5>Math.random()?0:1;m[e][a]=n,t.push({x:e,y:a,val:n})}await C(t,[],B,.7,256),L(),N()},W=t=>new l.default({canvas:x,onSuccess:O,maskColor:"rgba(143, 122, 102, 0.5)",primaryColor:"#EDA166",textTitle:t}),O=()=>{v=!1,m=Array.from({length:4},()=>[,,,,].fill(-1)),g=0,w=[],y=[],T=[],E=[],R()},q=t=>t*(20+i)+20,I=(t,e,a,n=i,l=0)=>{let[r,o,s]=[h,d,u].map(t=>t[a]);$(t,e,o,n),f.font=`${s*(1+l)}px serif`,f.fillStyle=a<2?"#645B52":"#F7F4EF",f.textBaseline="middle",f.textAlign="center",f.fillText(r,q(t)+n/2,q(e)+n/2)},N=()=>m.forEach((t,e)=>t.forEach((t,a)=>-1!==t&&I(e,a,t))),$=(t,e,a=s,n=i)=>U(q(t),q(e),n,n,6,a),L=()=>{U(0,0,r,o,6,"#AD9D8F");for(let t=0;t<4;t++)for(let e=0;e<4;e++)$(t,e)},U=(t,e,a,n,l=c,i)=>{f.beginPath(),f.moveTo(t+l,e),f.arcTo(t+a,e,t+a,e+n,l),f.arcTo(t+a,e+n,t,e+n,l),f.arcTo(t,e+n,t,e,l),f.arcTo(t,e,t+a,e,l),f.closePath(),i&&(f.fillStyle=i,f.fill())},j=t=>{let e=[];return t.forEach((a,n)=>a.forEach((a,l)=>-1===t[n][l]&&e.push({x:n,y:l}))),e[Math.floor(Math.random()*e.length)]};window.onload=R;